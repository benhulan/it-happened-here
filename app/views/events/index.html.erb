<h1>Hello world!</h1>
<h3>Welcome, user!!!! </h3>

<div class="text-center">

<h5> <span id="yourlocation"></span></h5>


<div>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>
<br>
<button class="hvr-wobble-vertical"><a  href="/events/new">Add a Historical Event</a></button>

<div id = "showEvents"></div>

<script src="http://maps.googleapis.com/maps/api/js?v=3&sensor=false&amp;libraries=places"></script>
<script type="text/javascript">

function initialize() {
     var map = new google.maps.Map(document.getElementById('map'), {
     zoom: 14,
      // center: new google.maps.LatLng(37.790841, -122.42),
    });

     if (navigator.geolocation) {
         navigator.geolocation.getCurrentPosition(function (position) {
             initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
             map.setCenter(initialLocation);
  //api location name
	getLocationName();

function getLocationName(){
	var url = "http://api.geonames.org/findNearbyPlaceName?lat=" + position.coords.latitude + "&lng=" + position.coords.longitude + "&username=jwyk";
	$.ajax({
		url: url,
		method: 'GET',
	}).done(function(object){
		var xml = object;
	 	var loc= $(xml).find("name").text();
	 	$("#yourlocation").append("Your current neighborhood is " + loc);
	});
}
//end of ajax
         });
     }

        loadData();
        //gon.watch renews data in gon variables!
        gon.watch;

function loadData (){
 gon.locations.forEach(function(location){
    var locationLatLong = new google.maps.LatLng(location.lat, location.lng);
    var marker = new google.maps.Marker({
        position: locationLatLong,
        map: map
    });


    google.maps.event.addListener(marker, 'click', function() {
      $('#showEvents').empty();
      
      gon.quickEvents.forEach(function(e){
        if (e.location_id == location.id) {
          $('#showEvents').slideDown( "slow", function() {
          // Animation complete.

          // When marker clicked, append event content to bottom of page and add class to div for location id
          $('#showEvents').append('<p>' + gon.locations[e.location_id].name + '</p>' + '<p>' + e.content + '</p>').addClass('' + e.location_id + '');
        });
        } 
      });
    });
    });
}
 }

 // Go to location page when event is clicked on
 $('#showEvents').on('click', function() {
    window.location.href = '/locations/' + $(this).attr('class');
 });

google.maps.event.addDomListener(window, 'load', initialize);

</script>

</div>